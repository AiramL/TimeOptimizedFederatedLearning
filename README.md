# TOFL: Time Optimized Federated Learning

This repository contains the code developed for SBSeg 2025. The code is composed by three parts. The first part simulates vehicles mobility, to extract this pattern to estimate the user delays, on the second part, using 5G technology. Finally, the third part simulates the federated learning training, given the latency values obtained during the first and second parts. The object is to test different client selection strategies in a scenario with mobility.

# Security considerations

Our code only uses CSV files pre-processed from simulated CAM data. Therefore, this code does not impose any risk for the host during its execution.

# Considered Stamps

We aim to obtain all four stamps from the conference: available, functional, sustainable, and reproducible.


# Minimum Requirement

- SO: Ubuntu 22.04.5 LTS
- Cores: 2
- Memory: 4 GB
- Storage: 64 GB

# Dependencies 

## This repository has the following dependencies: 

- Git command 2.34.1
- Python3.12
- VirtualBox 7.1.12 (for the VM execution only)
- Conda 25.5.1
- SUMO 1.24.0
- pandas 2.3.1
- numpy 1.26.4
- torch 2.3.0
- torchvision 0.18.0
- matplotlib 3.10.3
- flower 1.7.0
- tensorflow 2.19.0
- scikit-learn 0.25.2
- seaborn 0.13.2
- scikit-image 1.7.1

# Installation

## Clone this repository:
```bash
git clone https://github.com/AiramL/TimeOptimizedFederatedLearning.git
```
## Change to the new directory
```bash
cd TimeOptimizedFederatedLearning
```

## Install conda

### Get the script to install miniconda
```bash
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
```

### Change script permissions
```bash
chmod +x Miniconda3-latest-Linux-x86_64.sh
```

### Execute installation
```bash
./Miniconda3-latest-Linux-x86_64.sh
```

### Run environment
```bash
source ~/.bashrc
```

## Create paths:
```bash
source scripts/build/paths.sh
```
## Install dependecies:
```bash
source scripts/build/dependencies.sh
```

## Accept the terms:
During the installation of dependencies and environment you might be asked to accept the terms of conda and SUMO. Make sure to enter yes. Also, conda enmvironment must be activated after its installation.

## Create the virtual environment:
```bash
source scripts/build/env.sh
```

Download datasets:
```bash
source scripts/build/datasets.sh
```

 
# Execution

All the codes were executed with root user on a virtual machine.

## Estimated execution time

The whole execution time depends on the hyperparameters chosen to the test. Therefore, we select XXX cars and XXX epochs for the minimum test, which should take around 15 minutes with those values. 

## Minimum test


We consider that the minimum test is to reproduce the figures in the paper. Therefore, we provide a simplified execution, which takes the data generated by our code. However, to test from scratch, we also provide a guide to do the complete execution, which takes a long time to generate all the requirements.

### Create SUMOs' trips: 
 
```bash
source scripts/run/raw/mobility.sh
```

### Process trips:

```bash
source scripts/run/processed/mobility.py
```

### Generate raw communication:
 
```bash
source scripts/run/raw/communication.sh
```

### Generate processed communication:

```bash
source scripts/run/processed/communication.sh
```

### Generate delay results:

This script selects the clients and generates the communication delay result for different algorithms:
```bash
python src/main.py
```

The previous python script generates several CSV files, which must be aggregated in order to be consumed. This can be doen by executing the following script:
```bash
python process_results/aggregate_individual_results.py
```
Another process that we should do is the delays per epoch, in order to show on the graphs:
```bash
python process_results/process_epoch.py
```

# Generate Figures

Training time figure: 

```bash
python generate_figures/communication.py
```

Epoch time figure: 

```bash
python generate_figures/epoch_delays.py
```

Energy figure: 

```bash
python generate_figures/energy.py
```

# LICENSE

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

