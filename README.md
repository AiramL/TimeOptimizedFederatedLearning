# TOFL: Time Optimized Federated Learning

This repository contains the code developed for SBSeg 2025. The code is composed by three parts. The first part simulates vehicles mobility, to extract this pattern to estimate the user delays, on the second part, using 5G technology. Finally, the third part simulates the federated learning training, given the latency values obtained during the first and second parts. The object is to test different client selection strategies in a scenario with mobility.

# Considered Stamps

We aim to obtain all four stamps from the conference: available, functional, sustainable, and reproducible.


# Minimum Requirement

- SO: Ubuntu 22.04.5 LTS
- Cores: 4
- Memory: 4 GB

# Dependencies 

Git command.
Python3.12.
vim
Conda is the only dependency that you need to install in order to execute the framework [1]. All the other dependencies are going to be downloaded with the provided scripts.

## Get conda installer

```bash
 wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
```

## Change the permissions

```bash
 chmod +x Miniconda3-latest-Linux-x86_64.sh
```

## Execute the installation

```bash
 ./Miniconda3-latest-Linux-x86_64.sh
```

## Reload bash

```bash
 source ~/.bashrc
```
# Installation

Clone this repository:

```bash
 git clone https://github.com/AiramL/TimeOptimizedFederatedLearning.git
```
Change to the new directory
```bash
 cd TimeOptimizedFederatedLearning
```
Create paths:
```bash
 source scripts/build/paths.sh
```
Install the requirements:

```bash
source scripts/build/env.sh
```

Download datasets:
```bash
 source scripts/build/datasets.sh
```

Install dependecies:
```bash
 source scripts/build/dependencies.sh
```
# Security considerations

Our code only uses CSV files pre-processed from simulated CAM data. Therefore, this code does not impose any risk for the host during its execution.

# Execution

All the codes were executed with root user on a virtual machine.

## Estimated execution time

The whole execution time depends on the hyperparameters chosen to the test. Therefore, we select XXX cars and XXX epochs for the minimum test, which should take around 15 minutes with those values. 

## Minimum test


We consider that the minimum test is to reproduce the figures in the paper. Therefore, we provide a simplified execution, which takes the data generated by our code. However, to test from scratch, we also provide a guide to do the complete execution, which takes a long time to generate all the requirements.

To reproduce the paper's experiments and reduce the execution time, download the data previously generated. This data contains mobility traces and communication conditions generated with SUMO and the communication model, respectively. The total size of all files is up to 200 GB.

## Complete execution

Create SUMOs' trips: 
 
```bash
 source scripts/generate_trips.sh
```

Process the trips:

```bash
 python process_results/processed_mobility.py
```

Generate raw communication:
 
```bash
 source scripts/raw_communication.sh
```

Generate processed communication:

```bash
 source scripts/processed_communication.sh
```

Generate delay results:

```bash
 python src/main.py
```
```bash
 python process_results/aggregate_individual_results.py
```
```bash
 python process_results/process_epoch.py
```
# Federated Learning Training


## Generate Figures

Training time figure: 

```bash
 python generate_figures/communication.py
```

Epoch time figure: 

```bash
 python generate_figures/epoch_delays.py
```

Energy figure: 

```bash
 python generate_figures/energy.py
```

# LICENSE

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

